/* Copyright (c) 2011 Peter van der Spek */
(function(e){var l={};var m;var k=false;var i={ellipsis:"...",setTitle:"never",live:false};e.fn.ellipsis=function(n,o){var q,p;q=e(this);if(typeof n!=="string"){o=n;n=undefined}p=e.extend({},i,o);p.selector=n;q.each(function(){var r=e(this);j(r,p)});if(p.live){h(q.selector,p)}else{g(q.selector)}return this};function j(v,o){var s=v.data("jqae");if(!s){s={}}var w=s.wrapperElement;if(!w){w=v.wrapInner("<div/>").find(">div");w.css({margin:0,padding:0,border:0})}var q=w.data("jqae");if(!q){q={}}var r=q.originalContent;if(r){w=q.originalContent.clone(true).data("jqae",{originalContent:r}).replaceAll(w)}else{w.data("jqae",{originalContent:w.clone(true)})}v.data("jqae",{wrapperElement:w,containerWidth:v.width(),containerHeight:v.height()});var u=v.height();var n=(parseInt(v.css("padding-top"),10)||0)+(parseInt(v.css("border-top-width"),10)||0)-(w.offset().top-v.offset().top);var t=false;var p=w;if(o.selector){p=e(w.find(o.selector).get().reverse())}p.each(function(){var z=e(this),y=e.trim(z.text()),x=false;if(w.innerHeight()-z.innerHeight()>u+n){z.remove()}else{d(z);if(z.contents().length){if(t){a(z).get(0).nodeValue+=o.ellipsis;t=false}while(w.innerHeight()>u+n){x=f(z);if(x){d(z);if(z.contents().length){a(z).get(0).nodeValue+=o.ellipsis}else{t=true;z.remove();break}}else{t=true;z.remove();break}}if(((o.setTitle=="onEllipsis")&&x)||(o.setTitle=="always")){z.attr("title",y)}else{if(o.setTitle!="never"){z.removeAttr("title")}}}}})}function f(o){var n=a(o);if(n.length){var p=n.get(0).nodeValue;var q=p.lastIndexOf(" ");if(q>-1){p=e.trim(p.substring(0,q));n.get(0).nodeValue=p}else{n.get(0).nodeValue=""}return true}return false}function a(n){if(n.contents().length){var p=n.contents();var o=p.eq(p.length-1);if(o.filter(c).length){return o}else{return a(o)}}else{n.append("");var p=n.contents();return p.eq(p.length-1)}}function d(n){if(n.contents().length){var p=n.contents();var o=p.eq(p.length-1);if(o.filter(c).length){var q=o.get(0).nodeValue;q=e.trim(q);if(q==""){o.remove();return true}else{return false}}else{while(d(o)){}if(o.contents().length){return false}else{o.remove();return true}}}return false}function c(){return this.nodeType===3}function h(o,n){l[o]=n;if(!m){m=window.setInterval(function(){b()},200)}}function g(n){if(l[n]){delete l[n];if(!l.length){if(m){window.clearInterval(m);m=undefined}}}}function b(){if(!k){k=true;for(var n in l){e(n).each(function(){var p,o;p=e(this);o=p.data("jqae");if((o.containerWidth!=p.width())||(o.containerHeight!=p.height())){j(p,l[n])}})}k=false}}})(jQuery);